import{R as t,u as n,r as e,j as s,a,t as r}from"./index-BPuXrSEs.js";import{M as o,T as i,B as l,R as d,H as c,a as p,_ as g,b as m,m as u}from"./Basemaps-ckCFzOMi.js";import{L as h,u as f}from"./hooks-C5XWxmLm.js";const b="data:image/svg+xml,%3csvg%20width='103'%20height='126'%20viewBox='0%200%20103%20126'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M83.6875%2063C83.6875%2091.556%2056.013%20110.037%2051.9863%20112.575C51.6771%20112.77%2051.3229%20112.77%2051.0137%20112.575C46.987%20110.037%2019.3125%2091.556%2019.3125%2063C19.3125%2039.375%2034.9084%2023.625%2051.5%2023.625C68.6667%2023.625%2083.6875%2039.375%2083.6875%2063Z'%20fill='%23C95300'/%3e%3cpath%20d='M68.1667%2063C68.1667%2074.4208%2060.6152%2083.5%2051.5%2083.5C42.3847%2083.5%2034.8333%2074.4208%2034.8333%2063C34.8333%2051.5792%2042.3847%2042.5%2051.5%2042.5C60.6152%2042.5%2068.1667%2051.5792%2068.1667%2063Z'%20fill='white'%20stroke='white'/%3e%3c/svg%3e",x="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='16'%20height='16'%20fill='%23575757'%20class='bi%20bi-geo-alt-fill'%20viewBox='0%200%2016%2016'%3e%3cpath%20d='M8%2016s6-5.686%206-10A6%206%200%200%200%202%206c0%204.314%206%2010%206%2010m0-7a3%203'/%3e%3c/svg%3e",y=(t,n)=>{return t.submission===n?new h.Icon({className:`number-marker marker-SOI marker-${t.submission}`,iconUrl:b,iconSize:[40,40],iconAnchor:[20,35]}):new h.DivIcon({className:`number-marker-related marker-${t.submission}`,html:(e=t.snp_distance,`\n  <div style="font-size: medium;\n  color: white;\n  font-weight: 500;\n  display: flex;\n  flex-wrap: nowrap;\n  flex-direction: row;\n  align-content: center;\n  justify-content: center;\n  align-items: center;\n"><img src="${x}" alt="${e}" width="30" height="30"/>\n<a style="position: absolute;">${e}</a><div/>`),styles:{border:"none",background:"transparent",display:"flex"},iconSize:[40,40],iconAnchor:[20,28]});var e},v=t.memo((({checkedLayers:t,useCountyandHotspotLayers:a,setOpenSideBar:r,openSideBar:u,SNPMapDataset:f,RiskLayers:b,CountyLayers:x,HotspotLayers:v})=>{const k=n((t=>t.counter.openSNPTable)),S=e.useRef(null),j=function(t,n){return`\n      <div id="popup_header_${t.animal_id}" class="fs-5 fw-bold">${t.animal_id}</div><br>\n        <div id="popTabContent">     \n          <table class="table table-striped">\n            <tbody>\n              <tr>\n                <td><strong>Submission:</strong></td>\n                <td>${n}</td> \n              </tr>\n              <tr>\n                <td><strong>Date of Birth:</strong></td>\n                <td>${t.dob}</td>\n              </tr>\n              <tr>\n                <td><strong>Slaughter Date:</strong></td>\n                <td>${t.slaughter_date}</td>\n              </tr>\n              <tr>\n                <td><strong>Miles:</strong></td>\n                <td>${parseFloat(t.distance).toFixed(2)}</td>\n              </tr>\n              <tr>\n                <td><strong>SNP Distance:</strong></td>\n                <td>${t.snp_distance}</td>\n              </tr>\n              <tr>\n                <td><strong>Precise Location:</strong></td>\n                <td>${t.cph}</td> \n              </tr>\n              <tr>\n                <td><strong>OS Map Reference:</strong></td>\n                <td>${t.os_map_ref}</td>\n              </tr>\n              <tr>\n                <td><strong>Species:</strong></td>\n                <td>${t.species}</td> \n              </tr>\n              <tr>\n                <td><strong>Animal Type:</strong></td>\n                <td>${t.animal_type}</td> \n              </tr>\n              <tr>\n                <td><strong>Sex:</strong></td>\n                <td>${"F"===t.sex?"Female":"M"===t.sex?"Male":"Unknown"}\n                </td>\n              </tr> \n              <tr>\n                <td><strong>Disclosing Test Type:</strong></td>\n                <td>${t.disclosing_test}</td>\n              </tr> \n              <tr>\n                <td><strong>Import Country:</strong></td>\n                <td>${null==t.import_country?"British":`${t.import_country}`}</td>\n              </tr> \n            </tbody>\n          </table>\n        </div>\n      </div>        \n      `},_={maxWidth:400,className:"relatedPopupOptions",autoClose:!1,closeOnClick:!1,maxHeight:300};return s.jsx("div",{ref:S,children:s.jsxs(o,{center:[53.3781,-1],zoom:6,zoomAnimation:!0,zoomAnimationThreshold:20,children:[s.jsx(i,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">\n          OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),s.jsx(l,{}),s.jsx(d,{}),s.jsx(c,{setOpenSideBar:r,openSideBar:u,type:"snp_map"}),s.jsx(p,{}),s.jsxs(e.Suspense,{fallback:s.jsx(s.Fragment,{}),children:[s.jsx(v,{isChecked:a.hotspotLayers}),s.jsx(x,{isChecked:a.countyLayers}),Object.keys(t).length>0&&s.jsx(b,{checkedLayers:t})]}),s.jsx(w,{SNPMapDataset:f,openTable:k,mapRef:S}),!k&&s.jsx(g,{chunkedLoading:!0,iconCreateFunction:t=>new h.DivIcon({html:`<span class="cluster-icon">${t.getChildCount()}</span>`,className:"cluster-icon",iconSize:[30,30]}),children:Object.keys(f).filter((t=>{var n,e;return"SOI"!==t&&t!==f.SOI&&(null==(n=f[t])?void 0:n.lat)&&(null==(e=f[t])?void 0:e.lon)})).map(((t,n)=>s.jsx(m,{ref:n=>{null==n||n.bindPopup(j({...f[t]},t),_)},icon:y({...f[t],submission:t},f.SOI),position:[f[t].lat,f[t].lon]},"snp_related_marker_"+n)))}),k&&s.jsx(s.Fragment,{children:Object.keys(f).filter((t=>{var n,e;return"SOI"!==t&&t!==f.SOI&&(null==(n=f[t])?void 0:n.lat)&&(null==(e=f[t])?void 0:e.lon)})).map(((t,n)=>s.jsx(m,{ref:n=>{null==n||n.bindPopup(j({...f[t]},t),_)},icon:y({...f[t],submission:t},f.SOI),position:[f[t].lat,f[t].lon]},"snp_related_marker_"+n)))}),Object.keys(f).filter((t=>t===f.SOI)).map(((t,n)=>s.jsx(m,{ref:n=>{null==n||n.bindPopup(j({...f[t]},t),_)},icon:y({...f[t],submission:t},f.SOI),position:[f[t].lat,f[t].lon]},"snp_related_marker_"+n)))]})})})),w=({SNPMapDataset:t,openTable:n,mapRef:s})=>{const o=a(),i=f(),l=new ResizeObserver((()=>{i&&s.current&&i.invalidateSize()})),d=new h.Control({position:"topright"});d.onAdd=function(t){const e=h.DomUtil.create("div","leaflet-control leaflet-bar");return e.setAttribute("id","btn__show-table"),e.onclick=function(){o(r())},n?e.insertAdjacentHTML("afterbegin",'<a class="snp-table-toggle">Hide Table</a>'):e.insertAdjacentHTML("afterbegin",'<a class="snp-table-toggle">Show Table</a>'),e};const c=new h.control({position:"topright"});c.onAdd=function(t){let n=h.DomUtil.create("div","leaflet-control leaflet-bar");return n.style.width="150px",n.style.background="white",n.insertAdjacentHTML("afterbegin",`\n    <div style="padding-top:5px;">\n        <span class="fs-6" style="padding-left:6px;"><strong>Legend</strong></span>\n        <span style="display: flex; align-items: center; padding-bottom: 5px;">\n          <img src=${b} class="legend-marker-img">\n          <span class="legend-marker-title">Sample</span>\n        </span>\n        <span style="display: flex; align-items: center; padding-bottom: 5px;padding-left: 8px;">\n        <img src=${x} width="25" height="25">\n          <span class="legend-marker-title">SNP Relatedness</span>\n        </span>\n        <span style="display: flex; align-items: center;">\n        <img src=${u} class="legend-marker-img">\n        <span class="legend-marker-title">Geographic Group</span>\n        </span>\n      </div>\n    `),n},e.useEffect((()=>{const n=Object.keys(t).filter((n=>{var e,s;return(null==(e=t[n])?void 0:e.lat)&&(null==(s=t[n])?void 0:s.lon)})).map((n=>[t[n].lat,t[n].lon]));return(null==n?void 0:n.length)>0&&(c.addTo(i),i.fitBounds(h.latLngBounds(n).pad(.1))),()=>{c.remove()}}),[t]),e.useEffect((()=>(d.addTo(i),()=>{d.remove()})),[n]),e.useEffect((()=>(s.current&&l.observe(s.current),()=>{l.disconnect()})),[])};export{v as default};
